<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>Stuttgart Talks: Game</title>
    <link rel="stylesheet" href="main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
</head>
<body class="game-body">
    <canvas id="snowCanvas"></canvas>
    <canvas id="iceFallCanvas" class="hidden"></canvas>

    <div id="iceOverlay" class="ice-overlay hidden"></div>
    <div id="fireOverlay" class="fire-overlay hidden"></div>
    <div id="cocoaOverlay" class="cocoa-overlay hidden"></div>

    <audio id="lavaAudio" src="minecraft-drinking-sound-effect.mp3" preload="auto"></audio>

    <div id="lastChanceTimer" class="hidden">
        <span>‚ö†Ô∏è –ü–û–°–õ–ï–î–ù–ò–ô –®–ê–ù–°: </span>
        <span id="timerCountdown">05:00</span>
    </div>

    <div class="game-wrap">
        <header class="game-header">
            <div class="header-left">
                <div class="avatar-circle" id="myTeamAvatar"></div>
                <div>
                    <span id="myNameHeader" class="player-name-header">...</span>
                    <div style="font-size: 0.8rem; opacity: 0.9;">
                        <strong id="myTeamName">...</strong> ‚Ä¢ <span id="myPlayerRole">...</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="icon-btn" onclick="openItemsGuide()">üìñ</button>
                <button class="icon-btn" onclick="openCraftModal()" style="color: #d946ef;">‚öíÔ∏è</button>
                <button id="btnShowTrades" class="secondary hidden" onclick="openIncomingTrades()">–û–±–º–µ–Ω ü§ù</button>
                <button id="btnLogout" class="icon-btn" style="color:var(--accent-red)">üö™</button>
                <button id="btnSpyAction" class="icon-btn hidden" onclick="openSpyModal()">üïµÔ∏è‚Äç‚ôÇÔ∏è</button>
                <button id="btnScavenge" class="icon-btn hidden" onclick="scavengeSnow()">üß§</button>
                <button id="btnGuardianWarm" class="icon-btn hidden" onclick="guardianWarmUp()">üî•</button>
            </div>
        </header>

        <main class="game-main">
            <aside class="inventory-panel card">
                <h2>üéí –†—é–∫–∑–∞–∫</h2>
                <ul id="inventoryList" class="inventory-list">
                    <li class="muted">–ü—É—Å—Ç–æ...</li>
                </ul>
            </aside>

            <section class="map-window card">
                <h2>üó∫Ô∏è –õ–æ–∫–∞—Ü–∏—è</h2>
                <div class="map-placeholder"></div>
            </section>

            <section class="bottom-panel">
                <div class="tasks-panel card">
                    <h2 style="display:flex; justify-content:space-between; align-items:center;">
                        –ú–∏—Å—Å–∏–∏ üìú 
                        <span id="taskProgress" style="font-size:0.9rem; color:var(--accent-green)">0%</span>
                    </h2>
                    <div class="tasks-container">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th style="width: 30px;">‚úî</th>
                                    <th>–¶–µ–ª—å</th>
                                    <th style="width: 30px; text-align:center;">üéÅ</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                <tr><td colspan="3" class="muted" style="padding:10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="team-info-panel card">
                    <h2>–°–æ—Å—Ç–∞–≤ (<span id="myTeamMembersCount">0</span>)</h2>
                    <ul id="currentTeamMembersList" class="member-list"></ul>
                </div>
            </section>
        </main>
    </div>

    <div id="itemsGuideModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header-strip"></div>
            <div class="modal-top-row">
                <h3 class="modal-title">üìñ –ü–†–ï–î–ú–ï–¢–´</h3>
                <button class="modal-close" onclick="closeItemsGuide()">√ó</button>
            </div>
            <div class="tasks-container" style="max-height: 400px; overflow-y: auto;">
                <table class="tasks-table">
                    <tbody id="itemsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="tradeModal" class="modal-backdrop hidden">
        <div class="modal-content">
             <div class="modal-header-strip"></div>
             <div class="modal-top-row">
                <h3 class="modal-title">ü§ù –ü–†–ï–î–õ–û–ñ–ò–¢–¨</h3>
                <button class="modal-close" onclick="closeTradeModal()">√ó</button>
            </div>
            <label class="label-accent">1. –ö–æ–º—É:</label> 
            <select id="tradeTargetTeam" class="modal-input"></select>
            <label class="label-accent" style="color:var(--accent-green)">2. –û—Ç–¥–∞–µ–º:</label> 
            <select id="tradeOfferSelect" class="modal-input"></select>
            <label class="label-accent" style="color:var(--accent-red)">3. –ü—Ä–æ—Å–∏–º:</label> 
            <select id="tradeRequestSelect" class="modal-input"></select>
            <button class="start-button" onclick="sendTradeRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>  

    <div id="incomingTradesModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header-strip"></div>
            <div class="modal-top-row">
                <h3 class="modal-title">üì® –í–•–û–î–Ø–©–ò–ï</h3>
                <button class="modal-close" onclick="closeIncomingTrades()">√ó</button>
            </div>
            <div id="incomingTradesList"></div>
        </div>
    </div>

    <div id="endGameModal" class="modal-backdrop hidden" style="z-index: 20000;">
        <div class="modal-content" style="text-align: center; border: 2px solid var(--accent-gold);">
            <h1 id="endTitle" style="font-size: 2rem; margin-bottom: 10px; text-transform: uppercase;"></h1>
            <p id="endMessage" style="font-size: 1.1rem; color: var(--text-main); margin-bottom: 20px; line-height: 1.5;"></p>
            <div id="winnersListBlock" class="hidden" style="margin: 15px 0; padding: 15px; background: rgba(255,215,0,0.1); border: 1px solid var(--accent-gold); border-radius: 10px;">
                <h3 style="color: var(--accent-gold); margin:0; font-size: 1rem;">üèÜ –ü–ï–†–í–´–ï –ú–ï–°–¢–ê:</h3>
                <p id="winnersNames" style="font-size: 1.3rem; font-weight: 900; color: #fff; margin-top: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5);"></p>
            </div>
            <p style="font-style: italic; color: var(--accent-green); margin-top: 20px; font-size: 1rem;">üìç –ü—Ä–æ—Å–ª–µ–¥—É–π—Ç–µ –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ª–æ–∫–∞—Ü–∏—é!</p>
            <button id="btnCloseModal" class="start-button hidden" onclick="document.getElementById('endGameModal').classList.add('hidden')">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <div id="targetModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-top-row">
                <h3 class="modal-title">‚ùÑÔ∏è –ó–ê–ú–û–†–û–ó–ò–¢–¨ –ö–û–ì–û?</h3>
                <button class="modal-close" onclick="closeTargetModal()">√ó</button>
            </div>
            <p class="muted" style="margin-bottom: 15px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –ø—Ä–æ–≥—Ä–µ—Å—Å:</p>
            <select id="targetSelect" class="modal-input" style="margin-bottom: 20px;"></select>
            <button id="btnConfirmFreeze" class="start-button" style="background: var(--accent-ice); color: #000;">
                –û–¢–ü–†–ê–í–ò–¢–¨ –•–û–õ–û–î
            </button>
        </div>
    </div>

    <div id="craftModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header-strip" style="background: linear-gradient(90deg, #d946ef, #8b5cf6);"></div>
            <div class="modal-top-row">
                <h3 class="modal-title" style="color: #d946ef;">‚öíÔ∏è –ú–ê–°–¢–ï–†–°–ö–ê–Ø</h3>
                <button class="modal-close" onclick="document.getElementById('craftModal').classList.add('hidden')">√ó</button>
            </div>
            <p class="muted" style="margin-bottom: 15px; text-align: center; font-size: 0.9rem;">
                –°–æ–µ–¥–∏–Ω—è–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã!
            </p>
            <div id="craftRecipesList" style="max-height: 60vh; overflow-y: auto; padding-right: 5px;"></div>
        </div>
    </div>

    <script type="module" src="game.js"></script>
</body>
</html>