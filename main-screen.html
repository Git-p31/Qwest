<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>Stuttgart Christmas Game</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="main.css" />
</head>
<body class="game-body">
    
    <canvas id="snowCanvas"></canvas>
    <canvas id="iceFallCanvas" class="hidden"></canvas>
    <div id="iceOverlay" class="ice-overlay hidden"></div>
    <div id="fireOverlay" class="fire-overlay hidden"></div>
    <div id="cocoaOverlay" class="cocoa-overlay hidden"></div>
    
    <audio id="lavaAudio" src="minecraft-drinking-sound-effect.mp3" preload="auto"></audio>

    <div id="lastChanceTimer" class="hidden">
        <span>‚ö†Ô∏è –ü–û–°–õ–ï–î–ù–ò–ô –®–ê–ù–°: </span>
        <span id="timerCountdown">05:00</span>
    </div>

    <div class="game-wrap">
        
        <header class="game-header">
            <div class="header-left">
                <div class="avatar-circle" id="myTeamAvatar"></div>
                <div>
                    <span id="myNameHeader" class="player-name-header">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    <div style="font-size: 0.8rem; opacity: 0.9;">
                        <strong id="myTeamName">...</strong> ‚Ä¢ <span id="myPlayerRole">...</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="icon-btn" onclick="window.openItemsGuide()" title="–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫">üìñ</button>
                <button class="icon-btn" onclick="window.openCraftModal()" style="color: #d946ef;" title="–ö—Ä–∞—Ñ—Ç">‚öíÔ∏è</button>
                
                <!-- ‚úÖ –ö–ù–û–ü–ö–ê –û–ë–ú–ï–ù–ê: –¢–û–õ–¨–ö–û –í–•–û–î–Ø–©–ò–ï, –¢–û–õ–¨–ö–û –î–õ–Ø –õ–ò–î–ï–†–û–í/–ü–ï–†–ï–ì–û–í–û–†–©–ò–ö–û–í -->
                <button id="btnShowTrades" class="secondary hidden" onclick="window.openIncomingTrades()">–í–•–û–î–Ø–©–ò–ï üíõ</button>
                
               
                <button id="btnSpyAction" class="icon-btn hidden" onclick="window.openSpyModal()" title="–®–ø–∏–æ–Ω–∞–∂">üïµÔ∏è‚Äç‚ôÇÔ∏è</button>
                <button id="btnScavenge" class="icon-btn hidden" onclick="window.scavengeSnow()" title="–ò—Å–∫–∞—Ç—å –≤ —Å–Ω–µ–≥—É">üß§</button>
                <button id="btnGuardianWarm" class="icon-btn hidden" onclick="window.guardianWarmUp()" title="–°–æ–≥—Ä–µ—Ç—å">üî•</button>
            </div>
        </header>

        <main class="game-main">
            
            <aside class="inventory-panel card">
                <h2>üéí –†—é–∫–∑–∞–∫</h2>
                <ul id="inventoryList" class="inventory-list">
                    <li class="muted">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤...</li>
                </ul>
            </aside>

            <div id="map-container" class="map-wrapper card">
                <div id="interactiveMap"></div>
                <button id="btnLocate" class="locate-btn">üìç –ì–¥–µ —è?</button>
                
                <div class="map-legend">
                    <div><span class="mark tent"></span> –ü–∞–ª–∞—Ç–∫–∞</div>
                    <div><span class="mark npc"></span> NPC</div>
                    <div><span class="mark team"></span> –ò–≥—Ä–æ–∫–∏</div>
                    <div><span class="mark me"></span> –í—ã</div>
                </div>
            </div>

            <section class="bottom-panel">
                <div class="tasks-panel card">
                    <h2 style="display:flex; justify-content:space-between; align-items:center;">
                        –ú–∏—Å—Å–∏–∏ üìú 
                        <span id="taskProgress" style="font-size:0.9rem; color:var(--accent-green)">0%</span>
                    </h2>
                    <div class="tasks-container">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th style="width: 30px;">‚úî</th>
                                    <th>–¶–µ–ª—å</th>
                                    <th style="width: 30px; text-align:center;">üéÅ</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                <tr><td colspan="3" class="muted" style="padding:10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="team-info-panel card">
                    <h2>–°–æ—Å—Ç–∞–≤ (<span id="myTeamMembersCount">0</span>)</h2>
                    <ul id="currentTeamMembersList" class="member-list">
                        <li class="muted">–ó–∞–≥—Ä—É–∑–∫–∞...</li>
                    </ul>
                </div>
            </section>
        </main>
    </div>

    <!-- Interaction Modal (–ø–∞–ª–∞—Ç–∫–∞, NPC) -->
    <div id="interactionModal" class="modal-backdrop hidden">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-header-strip"></div>
            <div class="modal-top-row">
                <h3 class="modal-title" id="interactTitle">...</h3>
                <button class="modal-close" onclick="document.getElementById('interactionModal').classList.add('hidden')">√ó</button>
            </div>
            
            <div id="interactIcon" style="font-size: 4rem; margin: 10px 0;">‚õ∫</div>
            
            <div id="interactDesc" style="margin-bottom: 20px; font-size: 1.1rem;">...</div>
            
            <div id="interactButtons" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;"></div>
        </div>
    </div>

    <!-- Items Guide -->
    <div id="itemsGuideModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header-strip"></div>
            <div class="modal-top-row">
                <h3 class="modal-title">üìñ –ü–†–ï–î–ú–ï–¢–´</h3>
                <button class="modal-close" onclick="window.closeItemsGuide()">√ó</button>
            </div>
            <div class="tasks-container" style="max-height: 400px; overflow-y: auto;">
                <table class="tasks-table">
                    <tbody id="itemsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- üíõ –ü–†–ï–î–õ–û–ñ–ò–¢–¨ –û–ë–ú–ï–ù (—Ç–æ–ª—å–∫–æ –∏–∑ –ø–∞–ª–∞—Ç–∫–∏) -->
    <div id="tradeModal" class="modal-backdrop hidden">
        <div class="modal-content">
             <div class="modal-header-strip"></div>
             <div class="modal-top-row">
                <h3 class="modal-title">üíõ –ü–†–ï–î–õ–û–ñ–ò–¢–¨ –û–ë–ú–ï–ù</h3>
                <button class="modal-close" onclick="window.closeTradeModal()">√ó</button>
            </div>
            <label class="label-accent">1. –ö–æ–º—É:</label> 
            <select id="tradeTargetTeam" class="modal-input"></select>
            <label class="label-accent" style="color:var(--accent-green)">2. –û—Ç–¥–∞–µ–º:</label> 
            <select id="tradeOfferSelect" class="modal-input"></select>
            <label class="label-accent" style="color:var(--accent-red)">3. –ü—Ä–æ—Å–∏–º:</label> 
            <select id="tradeRequestSelect" class="modal-input"></select>
            <button class="start-button" onclick="window.sendTradeRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>  

    <!-- üì® –í–•–û–î–Ø–©–ò–ï –ó–ê–ü–†–û–°–´ –ú–æ–¥—É–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="incomingTradesModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header-strip"></div>
            <div class="modal-top-row">
                <h3 class="modal-title">üì® –í–•–û–î–Ø–©–ò–ï</h3>
                <button class="modal-close" onclick="window.closeIncomingTrades()">√ó</button>
            </div>
            <div id="incomingTradesList"></div>
        </div>  
    </div>

    <!-- End Game Modal -->
    <div id="endGameModal" class="modal-backdrop hidden" style="z-index: 20000;">
        <div class="modal-content" style="text-align: center; border: 2px solid var(--accent-gold);">
            <h1 id="endTitle" style="font-size: 2rem; margin-bottom: 10px; text-transform: uppercase;"></h1>
            <p id="endMessage" style="font-size: 1.1rem; color: var(--text-main); margin-bottom: 20px; line-height: 1.5;"></p>
            <button id="btnCloseModal" class="start-button hidden" onclick="document.getElementById('endGameModal').classList.add('hidden')">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <!-- Spy Target Modal -->
    <div id="targetModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-top-row">
                <h3 class="modal-title">‚ùÑÔ∏è –ó–ê–ú–û–†–û–ó–ò–¢–¨ –ö–û–ì–û?</h3>
                <button class="modal-close" onclick="window.closeTargetModal()">√ó</button>
            </div>
            <p class="muted" style="margin-bottom: 15px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –ø—Ä–æ–≥—Ä–µ—Å—Å:</p>
            <select id="targetSelect" class="modal-input" style="margin-bottom: 20px;"></select>
            <button id="btnConfirmFreeze" class="start-button" style="background: var(--accent-ice); color: #000;">
                –û–¢–ü–†–ê–í–ò–¢–¨ –•–û–õ–û–î
            </button>
        </div>
    </div>

    <!-- Craft Modal -->
    <div id="craftModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header-strip" style="background: linear-gradient(90deg, #d946ef, #8b5cf6);"></div>
            <div class="modal-top-row">
                <h3 class="modal-title" style="color: #d946ef;">‚öíÔ∏è –ú–ê–°–¢–ï–†–°–ö–ê–Ø</h3>
                <button class="modal-close" onclick="document.getElementById('craftModal').classList.add('hidden')">√ó</button>
            </div>
            <div id="craftRecipesList" style="max-height: 60vh; overflow-y: auto; padding-right: 5px;"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script type="module" src="game.js"></script>
</body>
</html>